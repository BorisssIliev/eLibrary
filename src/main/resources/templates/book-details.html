<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${book.title}">Book Details</title>
    <link th:href="@{/css/books-details_style.css}" rel="stylesheet">
</head>
<body>

<header class="header">
    <h1 th:text="${book.title}">Book Title</h1>
    <a href="/v1/index" class="btn back-btn">‚¨Ö –ù–∞–∑–∞–¥</a>
</header>

<main>
    <section class="book-container">
        <div class="book-cover">
            <img th:if="${book.bookImages != null and not #lists.isEmpty(book.bookImages)}"
                 th:src="@{'/images/' + ${book.bookImages[0].imageName}}"
                 alt="Book Cover" width="300"/>

            <img th:unless="${book.bookImages != null and not #lists.isEmpty(book.bookImages)}"
                 th:src="@{/images/default-book-cover.jpg}"
                 alt="Default Cover" width="300"/>
        </div>
        <div class="book-info">
            <p><strong>–ê–≤—Ç–æ—Ä:</strong> <span th:text="${book.author}"></span></p>
            <p><strong>–ñ–∞–Ω—Ä:</strong> <span th:text="${book.genre}"></span></p>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong></p>
            <p class="book-summary" th:text="${book.summary}"></p>
            <p><strong>–î–∞—Ç–∞ –Ω–∞ –ø—É–±–ª–∏–∫—É–≤–∞–Ω–µ:</strong> <span th:text="${formattedDate}"></span></p>
            <p><strong>ISBN:</strong> <span th:text="${book.isbn}"></span></p>
        </div>
    </section>

    <!-- –°—ä–æ–±—â–µ–Ω–∏—è –∑–∞ —É—Å–ø–µ—Ö/–≥—Ä–µ—à–∫–∞ -->
    <div th:if="${message}" class="message success">
        <p th:text="${message}"></p>
    </div>
    <div th:if="${error}" class="message error">
        <p th:text="${error}"></p>
    </div>

    <!-- –§–æ—Ä–º–∞ –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫–Ω–∏–≥–∞—Ç–∞ -->
    <th:block th:if="${loggedIn}">
        <form th:action="@{/v1/saved-books/save}" method="post" class="save-form">
            <input type="hidden" name="bookId" th:value="${book.id}" />
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="btn save-btn">üìö –ó–∞–ø–∞–∑–∏ –∫–Ω–∏–≥–∞</button>
        </form>
    </th:block>

    <!-- –§–æ—Ä–º–∞ –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä -->
    <div class="comments-section">
        <h3>–ö–æ–º–µ–Ω—Ç–∞—Ä–∏</h3>

        <div th:if="${comments != null and !comments.isEmpty()}">
            <div th:each="comment : ${comments}" class="comment-box">
                <p><strong th:text="${comment.authorName}"></strong> –∫–∞–∑–∞:</p>
                <p th:text="${comment.content}"></p>
                <small th:text="${#temporals.format(comment.createdAt, 'dd-MM-yyyy HH:mm')}"></small>

                <!-- –ë—É—Ç–æ–Ω –∑–∞ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ, –≤–∏–¥–∏–º —Å–∞–º–æ –∞–∫–æ –µ –∞–≤—Ç–æ—Ä -->
                <form th:if="${comment.author}" th:action="@{'/v1/books/' + ${book.id} + '/comment/' + ${comment.id} + '/delete'}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn delete-btn">üóë –ò–∑—Ç—Ä–∏–π</button>
                </form>
            </div>
            </div>

        <div th:if="${comments == null or comments.isEmpty()}">
            <p>–í—Å–µ –æ—â–µ –Ω—è–º–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏. –ë—ä–¥–µ—Ç–µ –ø—ä—Ä–≤–∏—è—Ç, –∫–æ–π—Ç–æ —â–µ –∫–æ–º–µ–Ω—Ç–∏—Ä–∞!</p>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –∑–∞ –Ω–æ–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä -->
    <form th:action="|/v1/books/${book.id}/comment|" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <label for="content">–í–∞—à–∏—è—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä:</label>
        <textarea id="content" name="content" required></textarea>

        <button type="submit">–î–æ–±–∞–≤–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
    </form>


    <!-- –ê–∫–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –Ω–µ –µ –ª–æ–≥–Ω–∞—Ç -->
    <th:block th:if="${!loggedIn}">
        <p class="login-message">üîí –ó–∞ –¥–∞ –∑–∞–ø–∞–∑–∏—Ç–µ –∫–Ω–∏–≥–∏ –∏ –¥–∞ –∫–æ–º–µ–Ω—Ç–∏—Ä–∞—Ç–µ, —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—Ç–µ –≤–ª–µ–∑–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞.</p>
        <a href="/auth/login" class="btn login-btn">üîë –í—Ö–æ–¥</a>
    </th:block>

</main>

<footer class="footer">
    <p>&copy; 2024 eLibrary. –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.</p>
</footer>

</body>
</html>
